from threading import Thread
import time 
from my_request import get_triggers
from trigger_functions import read_triggers_json
from cam import cam_main

count = 0
triggers= read_triggers_json()

def kronos():
    global count
    while True:
        time.sleep(1)
        count+=1
        print("Count is:",count)

def update_triggers():
    global triggers
    global count
    while True:
        if count%10==0:
            triggers=get_triggers()
            print("------------------Triggers Updated------------------")
            print(triggers)
            print("----------------------------------------------------")
        time.sleep(1)
            
def execute_triggers():
    global triggers
    while True:
        execute_single_trigger("cam")


def execute_single_trigger(trigger_name):
    global triggers
    if triggers[trigger_name]["active"]:
        cam_main()

if __name__ == "__main__":
    t_kronos = Thread(target=kronos)
    t_update_triggers = Thread(target=update_triggers)
    t_execute_triggers = Thread(target=execute_triggers)
    t_kronos.start()
    t_update_triggers.start()
    t_execute_triggers.start()